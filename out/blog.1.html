<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <!-- Our site title and description -->
    <title>Blog | Jose quesada: E-commerce database marketing</title>
    <meta name="description" content="Website of Jose Quesada." />
    <meta name="keywords" content="quesada, jose quesada, R, semantic web, semantic analysis, predictive models, statistics, machine learning, marketing, psychographics, cognitive science, database marketing" />
    <meta name="author" content="Jose Quesada" />

    <!-- Output DocPad produced meta elements -->
    <meta http-equiv="X-Powered-By" content="DocPad"/>

    <!-- Mobile viewport optimized: h5bp.com/viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- DocPad Meta Information -->
    <meta http-equiv="X-Powered-By" content="DocPad"/>


    <!-- Shims: IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link rel="stylesheet" href="/styles/skeleton.css" />
    <link rel="stylesheet" href="/styles/base.css" />
    <link rel="stylesheet" href="/styles/layout.css" />
    <link rel="stylesheet" href="/styles/font-awesome.css" />
    <link rel="stylesheet" href="/styles/github.css" />

    <!-- convertable contact forms with analytics -->
    <script type="text/javascript">
    var trackerID = "3a39856ed90784117b180fecb5102e79"; // account identifier
    document.write("<script type=\"text/JavaScript\" src=\"http://convertable.com/admin/script.js\"></"+"script>");
    </script>

    <!-- google analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', "UA-36430477-1"]);
      _gaq.push(['_setDomainName', 'josequesada.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

    <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
        typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
        mixpanel.init("3fcbcafa555fc23a2d9863437ee2af0d");</script><!-- end Mixpanel -->
</head>

<body>

    <div class="wrap-header">
        <div class="container">
            <h1 class="logo"><a href="/" title="Jose Quesada PhD Ecommerce database marketing">Jose Quesada</a></h1>
            <nav class="primary">
                <ul>
                    <li><a href="/problems-and-solutions.html">problems & solutions</a> / </li>
                    <!-- <li><a href="/why-you-should-work-with-me.html">problems & solutions</a> / </li> -->
                    <li><a href="/blog.html">blog</a> / </li>
                    <li><script type="text/javascript" language="javascript">
                    <!--
                    // Email obfuscator script 2.1 by Tim Williams, University of Arizona
                    // Random encryption key feature by Andrew Moulden, Site Engineering Ltd
                    // This code is freeware provided these four comment lines remain intact
                    // A wizard to generate this code is at http://www.jottings.com/obfuscator/
                    { coded = "Ga@EOmac4amWvW.7OG"
                      key = "01yc9R8u3rmDNFLvWo5AC7YgV4nfG6zMjwkOxHJUileBZQTqbKE2IpsPShtdaX"
                      shift=coded.length
                      link=""
                      for (i=0; i<coded.length; i++) {
                        if (key.indexOf(coded.charAt(i))==-1) {
                          ltr = coded.charAt(i)
                          link += (ltr)
                        }
                        else {
                          ltr = (key.indexOf(coded.charAt(i))-shift+key.length) % key.length
                          link += (key.charAt(ltr))
                        }
                      }
                    document.write("<a href='mailto:"+link+"'>contact</a>")
                    }
                    //-->
                    </script><noscript>Sorry, you need Javascript on to email me.</noscript>
                    </li>
                </ul>
            </nav>
        </div>
    </div>


<!-- end header and top nav bar -->


    <div class="container post">


    
    <article id="post" class="post">
        <h1><a href='/posts/technical-reasons-not-to-pic-google-website-optimizer.html'>Technical reasons not to use google website optimizer (and Usability reasons too)</a></h1>
        <div class="post-date">Friday, December 21, 2012</div>
        <div class="post-content">
            <p>AB testing shows multiple variations of your website and measures which
one leads to higher sales. If you have 100 visitors a day, AB testing
can turn 2 purchases into 12 purchases, all with the same amount of
daily traffic. Google Website Optimizer (GWO) comes from a company that
knows AB testing, most shopping carts support it via plugins, and is
free. How could this be a bad choice? The devil is in the details. I’ll
list a few reasons.</p>

<h2>Ambiguous goal</h2>

<p>GWO seemingly aims at two clients, the non-technical marketer, and the
technical person (who happily inserts javascript on their pages). But it
doesn’t serve either of them particularly well.</p>

<h3>The non-technical Marketing expert</h3>

<p>GWO targets the non-technical marketer, since you do not need to write
code to use GWO. Since some small shops do not have technical talent in
house, and big shops have overloaded IT departments, not having to write
code is a big plus. Even in shops large enough to have an IT department
AND resources for AB testing, in our experience IT usually is pretty
isolated from the marketing department. Having the marketers do their
own tests is very empowering. If ease-of-use and simplicity are the
goals, then there are better, simpler tools. Even visual ones. Marketers
who want to run AB testing without code can use Optimizely or Visual
Website Optimizer. Optimizely goal is “to make it as easy as humanly
possible for you to create and run A/B tests on your site. All you need
to do is enter your website URL and point and click on what you want to
change. Absolutely no coding or engineering required. “ Visual Website
Optimizer is an excellent choice too. We just don’t see very many shops
actually using either of them, but we will cover this on another post.</p>

<h3>The programmer</h3>

<p>Actually, the hipster term for a programmer tasked to do this work on a
website is ‘Growth hacker’ :) Turns out that for a ‘Growth hacker’ is at
a loss when using GWO. The ‘data scientist’ in your team won’t be very
happy either. GWO won&#39;t let you play around with the data they collected
for you.You will know that one variation performed better than the
other. You wouldn&#39;t know if one variation resulted in more time spent,
less advert clicks, more user interaction (in terms of comments), or
more purchases. And you won&#39;t know how it affected your overall funnel
behavior. The ‘Growth hacker’ will be the first to point out a bunch of
technical reasons in which it GWO fails short&hellip;</p>

<h2>Technical reasons</h2>

<h3>Problems with dynamic sites</h3>

<p>The ‘Growth hacker’ will not be happy with how GWO deals with dynamic
content. Google Website Optimizer does &ldquo;in-line content replacement&rdquo; of
tested elements. That&#39;s not a problem on static landing pages, but it&#39;s
a no-go on most dynamic sites. Which happen to be a majority on 2012’s
internet. In GWO, you end up essentially having to rewrite any variant
to be displayable in Javascript. pages where you have AJAX and Flash
elements are possible, but require workarounds.</p>

<h3>Two-url requirement</h3>

<p>Using variation pages causes SEO and site problems when the test ends
unless you manage your server to produce 301 errors. So you&#39;ll either
need to keep the losers alive forever or set up redirects from each of
the losers to the winner every time you end a test. If being a lot of
server admin work was not enough, this has consequences for the test
results. The browsers loads two pages, and then it redirects to one of
the two alternatives. As a consequence, the marginal load for the
redirect to B artificially biases test results. Search engines penalize
duplicate content, which is exactly what you get when your two
variations, in independent URLs, are online. I believe google is smart
enough to detect the doings of its own product, and not penalizing GWO
users. But even without this penalty, putting the same content on two
URLs visible to users encourages them to link to both. Even after the
test declared it as a loser, the second url may need to stay around
forever. In fact, you risk to disappoint the users that bookmarked the
alternative which lost.</p>

<h3>Load time</h3>

<p>Every time you do a test with two alternatives, it will cost you an
extra page load. With shoppers being extremely sensitive to <a href="http://www.hindawi.com/journals/ahci/2009/121494/tab2/">loading
times</a>, speed is
crucial. Causing an extra page load is just about the worst thing you
can do for page load speed.</p>

<h3>To Google Website Optimizer, all of your visitors are the same</h3>

<p>In the current GWO, you cannot filter which users go into the test. Not
by search terms. Not by geography. Not by demographics.This goes against
the very essence of optimization. Using demographics for targeting
should be trivial, and a big honking feature for any testing software.
In fact, the web seems to start leaving behind demographics and focus on
psychographics. Times cannot be better for targeting. Consumer are
divided according to their lifestyle, personality, values&hellip; There are
some spectacular examples out there. Target could <a href="http://www.forbes.com/sites/kashmirhill/2012/02/16/how-target-figured-out-a-teen-girl-was-pregnant-before-her-father-did/">predict that a teen
girl was pregnant before her father
did</a>.
With some thought, and a good campaign, one can get incredibly accurate
targeting. Demographics help you understand who buys your product or
service, while psychographics helps you understand why they buy. Another
way to put it is that demographics are things that can be observed from
the outside, such as age and race, while psychographics are internal
attributes or attitudes. Still, GWO will not let you use your
hard-earned targeting results.</p>

<h2>Usability reasons</h2>

<h3>Time it takes to set up a test</h3>

<p>Using GWO, I feel It takes me too many steps to get to results. It
doesn’t feel productive. This is a reason why you often see Google
Website Optimizer only used on static landing pages and other non-core
site areas. As mentioned above, it just doesn’t work very well with
dynamic pages. That is, most contemporary CMS-based sites would have to
be ‘bypassed’ somehow. You&#39;ll need to manually create all of the
different pages you&#39;re going to test. But time is of issue not only for
the servers: the humans doing it in Javascript sacrifices convenience,
to a level that may make you too lazy to actually test things. For
example, deploying an AB test live on one of my sites took two minutes
(using a server-side test framework), but when I run experiments with
GWO it requires 15 minutes at a minimum.</p>

<h3>Dealing with tags</h3>

<p>Google calls them &ldquo;page sections.&rdquo; Omniture calls them &ldquo;mboxes.&rdquo; They
define sections that you want to affect in your testing. For this
approach to work, you have to wrap tags around every variable area on
every page and/or template. If you make changes later, then you’ll have
to re-tag, re-QA, and push again your code. This is enough work to make
me think twice about doing any testing. I can see how shops, with
limited resources, struggle to do proper testing, or simply postpone it
to the mythical day ‘when we have more resources’. In sum, google
website optimizer’s usability would make
<a href="http://dilbert.com/strips/comic/2007-11-16/">Mordac</a> proud.</p>

<h2>Summary</h2>

<p>In our experience, Businesses see the value in A/B testing but they just
aren&#39;t doing it. If you, or anyone on your team, can program, it’s worth
looking at a server-side solution (more on this in another post). A
server-side solution will have several advantages:</p>

<ul>
<li>  It leads to faster loading pages, prevent horrible mistakes, and
gives more flexibility to target your visitors, as we saw in
‘technical reasons’</li>
<li>  It’s easier to set up tests, as we saw in the ‘usability’ section</li>
</ul>

<p>Finally, all data stays in-house. If you ever come up with some better
analytic method, you can run it retrospectively. Google Website
Optimizer is a great product but if you are short on time and don&#39;t want
to muck with your code, look somewhere else. For more reviews, see
<a href="http://mroptimization.com/multivariate-testing-and-targeting-vendors/multivariate-testing-with-google-website-optimizer-the-final-word">this</a>
(on multivariate testing). Why do we care? Soon, we will open up the
beta for fluidshopping, where we tackle this problem heads on. If you
feel your shop should be doing be doing more A/B testing, or just doing
it more efficiently, keep tuned. If you <a href="http://fluidshopping.com/">give us your
email</a>, we will let you know when it’s ready.</p>

        </div>
    </article>
    <hr/>

    
    <article id="post" class="post">
        <h1><a href='/posts/unit-testing-docpad-plugins.html'>Unit Testing DocPad plugins</a></h1>
        <div class="post-date">Monday, December 03, 2012</div>
        <div class="post-content">
            <p>In the <a href="/posts/creating-a-docpad-plugin.html">last post</a> I detailed how I put together the <a href="http://github.com/benjamind/docpad-plugin-paged">Paged Plugin</a> for DocPad. After I got the plugin up and running on my own site, I decided I&#39;d give back to the community and publish it on NPM for everyone to use. This entailed pulling the plugin out into a standalone module, and getting the unit testing working so I knew it was all good to go.</p>

<p>In order to do this I first had to setup the following folder structure:</p>

<pre class="highlighted"><code class="bash">docpad-plugin-paged/
                    src/
                        paged.plugin.coffee
                        paged.tester.coffee
                    test/
                         out-expected/
                                       paged-count.html
                                       paged-count.1.html
                                       paged-count.2.html
                         src/
                             documents/
                                       page-count.html.eco
                             paged.test.js
                         package.json
                    Makefile
                    README.md
                    package.json
</code></pre>

<p>The <code>package.json</code> remains mostly the same as in previous exmaples with a small addition:</p>

<pre class="highlighted"><code class="r">    <span class="keyword">...</span>

    <span class="string">"devDependencies"</span>: {
        <span class="string">"coffee-script"</span>: <span class="string">"1.4.x"</span>
    },
    <span class="string">"scripts"</span>: {
        <span class="string">"test"</span>: <span class="string">"node ./test/paged.test.js"</span>
    }

    <span class="keyword">...</span>
</code></pre>

<p>The <code>devDependencies</code> object specfies dependencies we have for development purposes only, in this case we need CoffeeScript to compile the plugin. The <code>scripts</code> object specifies the test runner that <code>npm</code> will use to test the plugin.</p>

<p>Note that I&#39;ve added a <code>Makefile</code> to the folder, this is fairly standard for all DocPad plugins and I copied it from <a href="https://github.com/docpad/docpad-plugin-partials/blob/master/Makefile">one of the existing ones</a>.</p>

<p>The source for our plugin is now in the <code>src</code> folder in the <code>paged.plugin.coffee</code> file as before, I&#39;ve also added some files here for testing purposes which I&#39;ll explain in more detail.</p>

<h3>Unit Testing</h3>

<p>Since I&#39;m releasing this code out into the wild it might also be wise to make sure it works so lets setup some unit testing. Thankfully DocPad has made this quite easy once you know how, with a suite of basic tests and expected output tests ready to roll so you don&#39;t have to do much to make sure your plugin is working correctly.</p>

<p>First we must create a &#39;tester&#39; for our plugin, this is defined in the new <code>paged.tester.coffee</code> file:</p>

<pre class="highlighted"><code class="scala"># Export Plugin Tester
module.exports = (testers) -&gt;
    # Define Plugin Tester
    <span class="class"><span class="keyword">class</span> <span class="title">MyTester</span> <span class="keyword">extends</span> <span class="title">testers</span>.<span class="title">RendererTester</span></span>
        # Configuration
        docpadConfig:
            logLevel: <span class="number">5</span>
            enabledPlugins:
                <span class="string">'paged'</span>: <span class="keyword">true</span>
                <span class="string">'eco'</span>: <span class="keyword">true</span>
</code></pre>

<p>Notice here we&#39;re extending from the testers.RendererTester class. This is provided by DocPad and is designed to execute the plugin on a collection of documents and tests its output against a folder of expected results (<code>out-expected</code>). To figure out exactly how this works you might want to take a look at the source <a href="https://github.com/bevry/docpad/blob/master/src/lib/testers.coffee">available here</a>. But all you really need to know is the <code>docpadConfig</code> is used to configure an instance of DocPad to be used during testing, so here we enable our plugin and anything else we&#39;ll need in our tests.</p>

<p>Next we need to sort out our <code>test</code> folder which will actually contain and specify our tests. First up is our <code>package.json</code> file in the <code>test</code> folder, this is used to specify the dependencies for the test and to allow NPM to hook everything up for us:</p>

<pre class="highlighted"><code class="json">{
    "<span class="attribute">name</span>": <span class="value"><span class="string">"docpad-plugin-paged-testsuite"</span></span>,
    "<span class="attribute">version</span>": <span class="value"><span class="string">"0.1.0"</span></span>,
    "<span class="attribute">private</span>": <span class="value"><span class="literal">true</span></span>,
    "<span class="attribute">dependencies</span>": <span class="value">{
        "<span class="attribute">docpad-plugin-eco</span>": <span class="value"><span class="string">"latest"</span>
    }</span>
}</span>
</code></pre>

<p>Now we can specify our actual test case in our <code>paged.test.js</code> file:</p>

<pre class="highlighted"><code class="erlang"><span class="function"><span class="title">require</span><span class="params">('docpad')</span>.<span class="title">require</span><span class="params">('testers')</span>.<span class="title">test</span><span class="params">(<span class="tuple">{plugin<span class="variable">Path</span>: <span class="variable">_</span>_dirname+'/..',plugin<span class="variable">Name</span>:'paged'}</span>)</span>;
</code></pre>

<p>All this does is get access to the testers module provided by DocPad and execute the test function passing in a configuration that tells DocPad how to run our plugin tests. All you actually have to specify is the <code>pluginPath</code> which in this case simply points to the parent folder which contains our plugins <code>package.json</code> and a <code>pluginName</code> which allows DocPad to properly instantiate our plugin. If you don&#39;t specify a <code>pluginName</code> property then DocPad will try and use the folder name of the plugin folder (in my case thats <code>docpad-plugin-paged</code> which does not match the filenames I used in my plugin).</p>

<p>Now for the content of the tests. Since we&#39;re using the RendererTester the test will consist of instanatiating a copy of DocPad and running it over the contents of the <code>/test/src/documents</code> folder and then comparing the resulting documents with the ones found in <code>/test/out-expected</code>. So simply place some documents in the folder and set it up as you would expect, for my simplest test I did the following in a file called <code>page-count.html.eco</code>:</p>

<pre class="highlighted"><code class="javascript">---
title: <span class="string">'Page Count Test'</span>
isPaged: <span class="literal">true</span>
pageCount: <span class="number">3</span>
pageSize: <span class="number">2</span>
---
<span class="xml"><span class="tag">&lt;<span class="title">header</span>&gt;</span>Page <span class="vbscript">&lt;%= @document.page.number+<span class="number">1</span> %&gt;</span> of <span class="vbscript">&lt;%= @document.page.count %&gt;</span> : Documents [<span class="vbscript">&lt;% <span class="keyword">for</span> i <span class="keyword">in</span> [@document.page.startIdx...@document.page.endIdx]: %&gt;</span><span class="vbscript">&lt;%= i %&gt;</span><span class="vbscript">&lt;%= <span class="comment">',' if i &lt; @document.page.endIdx-1 %&gt;</span></span><span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span>]<span class="tag">&lt;/<span class="title">header</span>&gt;</span>
</span></code></pre>

<p>This exercises my plugin by making it generate 3 pages each containing 2 documents, outputting a little HTML in each one. In order to make the test pass I just need to add the expected output to the appropriate folder each file goes a little somethind like this:</p>

<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">header</span>&gt;</span>Page 1 of 3 : Documents [0,1]<span class="tag">&lt;/<span class="title">header</span>&gt;</span>
</code></pre>

<p>See <a href="https://github.com/benjamind/docpad-plugin-paged/tree/master/test/out-expected">the source</a> for more details.</p>

<h3>Running the tests</h3>

<p>So we&#39;ve setup the appropriate file structure, and added our tests. How do we actually execute them? Well its quite simple, but it requires a little more setup than you would hope at first. Because we added the <code>test</code> script to our <code>package.json</code> specifying a path to the test file we can use the command <code>npm test</code> to execute our test suite. However if you run that now you&#39;ll probably get an error message of some sort:</p>

<pre class="highlighted"><code class="matlab">$ npm test

&gt; docpad-plugin-paged@<span class="number">0.1</span><span class="number">.3</span> test C:\Workspace\docpad-plugin-paged
&gt; node ./test/<span class="transposed_variable">paged.</span><span class="transposed_variable">test.</span>js


<span class="transposed_variable">module.</span>js:<span class="number">340</span>
    throw err;
          ^
Error: Cannot <span class="built_in">find</span> module <span class="string">'docpad'</span>
    at <span class="transposed_variable">Function.</span><span class="transposed_variable">Module.</span>_resolveFilename (<span class="transposed_variable">module.</span>js:<span class="number">338</span>:<span class="number">15</span>)
    at <span class="transposed_variable">Function.</span><span class="transposed_variable">Module.</span>_load (<span class="transposed_variable">module.</span>js:<span class="number">280</span>:<span class="number">25</span>)
    at <span class="transposed_variable">Module.</span>require (<span class="transposed_variable">module.</span>js:<span class="number">362</span>:<span class="number">17</span>)
    at require (<span class="transposed_variable">module.</span>js:<span class="number">378</span>:<span class="number">17</span>)
    at <span class="transposed_variable">Object.</span>&lt;anonymous&gt; (C:\Workspace\docpad-plugin-paged\test\<span class="transposed_variable">paged.</span><span class="transposed_variable">test.</span>js:<span class="number">1</span>:<span class="number">63</span>)
    at <span class="transposed_variable">Module.</span>_compile (<span class="transposed_variable">module.</span>js:<span class="number">449</span>:<span class="number">26</span>)
    at <span class="transposed_variable">Object.</span><span class="transposed_variable">Module.</span><span class="transposed_variable">_extensions..</span>js (<span class="transposed_variable">module.</span>js:<span class="number">467</span>:<span class="number">10</span>)
    at <span class="transposed_variable">Module.</span>load (<span class="transposed_variable">module.</span>js:<span class="number">356</span>:<span class="number">32</span>)
    at <span class="transposed_variable">Function.</span><span class="transposed_variable">Module.</span>_load (<span class="transposed_variable">module.</span>js:<span class="number">312</span>:<span class="number">12</span>)
    at <span class="transposed_variable">Module.</span>runMain (<span class="transposed_variable">module.</span>js:<span class="number">492</span>:<span class="number">10</span>)
npm ERR! Test <span class="transposed_variable">failed.</span>  See above <span class="keyword">for</span> more <span class="transposed_variable">details.</span>
npm
</code></pre>

<p>Not good. In order to get this working I had to turn to <a href="http://balupton.com/">Benjamin Lupton</a> the creator of DocPad for some answers. In short to setup the testing structure we need to get the development version of DocPad, compile it, and setup symlinks so that your plugin tests can use it. So to get everything setup you&#39;ll need to install the DocPad source, and setup a symlink to it, thankfully this is quite easy:</p>

<ol>
<li><code>git clone <a href="https://github.com/bevry/docpad.git&lt;/code&gt;">https://github.com/bevry/docpad.git&lt;/code&gt;</a> - Clone the DocPad respository into your workspace (not your plugin folder)</li>
<li><code>cd docpad</code> - move into the new folder</li>
<li><code>npm install</code> - install the DocPad dependencies locally</li>
<li><code>npm link</code> - link the DocPad folder you have now created into npm, this means when you use DocPad on your machine it points to this working folder</li>
<li><code>make compile</code> - compile DocPad so its ready to use</li>
</ol>

<p>Now we need to do something similar for your plugin:</p>

<ol>
<li><code>cd docpad-plugin-paged</code> - move into the folder for your plugin</li>
<li><code>npm install</code> - install the dependencies for your plugin</li>
<li><code>npm link docpad</code> - add the linked version of DocPad to your plugins dependencies</li>
<li><code>make compile</code> - compile your plugin</li>
<li><code>make test</code> - run the tests!</li>
</ol>

<p>Hopefully your tests should now run and pass!</p>

<h3>Publishing on NPM</h3>

<p>To round everything out I simply added some details to my <code>README.md</code> file and added an <code>.npmignore</code> file to my folder containing the following:</p>

<pre class="highlighted"><code class="haskell">.travis*
<span class="type">Makefile</span>

<span class="title">src</span>/
<span class="title">out</span>/test/
<span class="title">test</span>/
</code></pre>

<p>This just tells npm to ignore my test folders and other things that are unnecessary. I then setup my user account on <a href="https://npmjs.org/signup"><a href="https://npmjs.org/signup&lt;/a&gt;">https://npmjs.org/signup&lt;/a&gt;</a> and added my user account details to my npm installation with <code>npm adduser</code>. After that publishing to npm is accomplished with the <code>npm publish</code> command.</p>

<p>There you have it, a fully tested, published plugin for DocPad. Hopefully this will be the first of many, I&#39;ve a few other ideas for things I&#39;d like to see in the project so we&#39;ll see if I can find time to make them. If you are trying to get a DocPad plugin up and running and are having problems give me a shout, or drop into talk to the incredibly helpful DocPad guys on the irc.freenode.org server channel #docpad.</p>

        </div>
    </article>
    <hr/>

    
    <article id="post" class="post">
        <h1><a href='/posts/creating-a-docpad-plugin.html'>Creating a DocPad plugin</a></h1>
        <div class="post-date">Sunday, December 02, 2012</div>
        <div class="post-content">
            <p>In order to complete the switch to DocPad I wanted my blog to support a paged index of my blog posts. I didn&#39;t want to display them all in one big long page, but split them up into groups of 3 or 5 with &#39;Older&#39; and &#39;Newer&#39; links to let users navigate the posts. Sadly this functionality isn&#39;t available by default in DocPad, but never fear DocPad is built with a plugin framework so we can add this functionality ourselves.</p>

<p>In the next couple of posts I&#39;m going to walk through the creation of the <a href="http://github.com/benjamind/docpad-plugin-paged">Paged Plugin</a> which I recently put together for just this purpose.</p>

<h3>A basic plugin</h3>

<p>The docpad site has a <a href="http://bevry.me/docpad/plugin-write">getting started guide</a> for how to setup a basic plugin thats a part of your site. Simply create the following folder and file structure where <code>yourPlugin</code> is the name of your plugin:</p>

<pre class="highlighted"><code class="bash">my-site/
        src
        ...
        plugins/
                  yourPlugin/
                               yourPlugin.plugin.coffee
                               package.json
        ...
        docpad.coffee
        README.md
        package.json
</code></pre>

<p>The <code>package.json</code> is required and needs to use the format specified on the <a href="http://bevry.me/docpad/plugin-write">docpad website</a>.</p>

<p>Much to my dislike the standard way of writing plugins for DocPad is with CoffeeScript, you could do it with straight JavaScript but you won&#39;t get as much help from the documentation. I&#39;ll look into writing a straight JavaScript plugin guide sometime in the future, for now lets just use CoffeeScript.</p>

<h3>Pagination</h3>

<p>For my paging implementation I wanted to be able to create a document in DocPad that was &#39;pageable&#39;, either looping over a collection of documents to render out sub-pages like on a blog index page, or looping a set number of times so that we can genereate pages on the fly or split up a long document across multiple pages. I tried out various ideas, and read <a href="https://github.com/bevry/docpad/issues/116">this issue</a> which details some possible solutions for paging. In the end I settled on the following approach:</p>

<ul>
<li>Set the <code>isPaged</code> property to true on pageable documents</li>
<li>Specify a <code>pageCount</code> property if you want a fixed number of pages <strong>or</strong></li>
<li>Specify a <code>pagedCollection</code> property which specifies the name of a collection over which you want paging to be applied.</li>
<li>Specify a <code>pageSize</code> property to set how many documents are looped over in each page.</li>
</ul>

<p>The plugin will function as follows:</p>

<ul>
<li>Before we render the documents

<ul>
<li>Loop over the documents</li>
<li>Find those that have the <code>isPaged</code> property

<ul>
<li>Read the <code>pageCount</code> or <code>pagedCollection</code> property to determine number of pages</li>
<li>Read the <code>pageSize</code> property to determine document indexes in each page</li>
<li>For every page we need to create:

<ul>
<li>Clone the document and add it to a new collection</li>
<li>Add a <code>page</code> object to the cloned document detailing current page details</li>
<li>Add a <code>firstPageDoc</code> object to the cloned document which points back to the original document</li>
</ul></li>
</ul></li>
<li>For every document in the new collection:

<ul>
<li>Normalize and contextualize the new document</li>
<li>Modify the <code>outFilename</code> and <code>basename</code> of the new document to reflect its page number</li>
</ul></li>
<li>Render the document collection</li>
</ul></li>
</ul>

<h3>To the code!</h3>

<p>So lets get started. Here&#39;s the basic plugin code that we&#39;re going to start with:</p>

<pre class="highlighted"><code class="php"> <span class="comment"># Export Plugin</span>
module.exports = (BasePlugin) -&gt;
    <span class="comment"># balUtil required for queing up tasks</span>
    balUtil = <span class="keyword">require</span>(<span class="string">'bal-util'</span>)

    <span class="comment"># Define Plugin</span>
    <span class="class"><span class="keyword">class</span> <span class="title">PagedPlugin</span> <span class="keyword">extends</span> <span class="title">BasePlugin</span>
        <span class="title">name</span>: '<span class="title">paged</span>'

        <span class="title">renderBefore</span>: (<span class="title">opts</span>,<span class="title">next</span>) -&gt;
            <span class="title">docpad</span> = @<span class="title">docpad</span>

            {</span>collection,templateData} = opts

            pagesToRender = <span class="keyword">new</span> docpad.FilesCollection()
...
</code></pre>

<p>This setups my basic plugin, it extends from <code>BasePlugin</code> and hooks into the <code>renderBefore</code> event, a full listing of all events in docpad is <a href="http://bevry.me/docpad/events">available here</a>. The <code>renderBefore</code> event receives two values in its <code>opts</code> argument, the <code>collection</code> and the <code>templateData</code>. The <code>collection</code> is the collection of documents that we are rendering, and the <code>templateData</code> is the data object that is passed to the documents when rendering. Note we also <code>require</code> the <a href="https://github.com/balupton/bal-util"><code>bal-util</code></a> module which we&#39;ll use later on.</p>

<p>Now we need to loop over our documents and figure out how / if they need paging:</p>

<pre class="highlighted"><code class="vbscript">...
            collection.forEach (document) -&gt;
                meta = document.getMeta()

                <span class="keyword">if</span> (!meta.<span class="keyword">get</span>(<span class="comment">'isPaged'))</span>
                    return

                # <span class="keyword">let</span> the page meta specify count <span class="keyword">or</span> use <span class="number">1</span> by <span class="keyword">default</span>
                numberOfPages = meta.<span class="keyword">get</span>(<span class="comment">'pageCount') or 1</span>
                pageSize = meta.<span class="keyword">get</span>(<span class="comment">'pageSize') or 5</span>
                lastDoc = pageSize * numberOfPages

                # <span class="keyword">if</span> pagedCollection <span class="keyword">is</span> specified <span class="keyword">then</span> use that <span class="keyword">to</span> determine number of pages
                <span class="keyword">if</span> meta.<span class="keyword">get</span>(<span class="comment">'pagedCollection')</span>
                    pagedCollectionName = meta.<span class="keyword">get</span>(<span class="comment">'pagedCollection')</span>
                    pagedCollection = docpad.getCollection(pagedCollectionName)
                    numberOfPages = Math.ceil(pagedCollection.length / pageSize)
                    lastDoc = pagedCollection.length

                # create a page object <span class="keyword">for</span> this page
                document.<span class="keyword">set</span>(page: {
                    count: numberOfPages,
                    number: <span class="number">0</span>,
                    size: pageSize,
                    startIdx: <span class="number">0</span>,
                    endIdx: Math.min(pageSize,lastDoc)
                })

                document.<span class="keyword">set</span>(firstPageDoc: document)

                # <span class="keyword">loop</span> over the number of pages we have <span class="keyword">and</span> generate a clone of this document <span class="keyword">for</span> <span class="keyword">each</span>
                <span class="keyword">if</span> numberOfPages &gt; <span class="number">1</span>
                    <span class="keyword">for</span> n <span class="keyword">in</span> [<span class="number">1.</span>.numberOfPages-<span class="number">1</span>]
                        pagedDocData = document.toJSON()

                        pagedDoc = docpad.createDocument(pagedDocData)
                        pagedDoc.<span class="keyword">set</span>(page: {
                            count: numberOfPages,
                            number: n,
                            size: pageSize,
                            startIdx: n*pageSize,
                            endIdx: Math.min((n*pageSize) + pageSize,lastDoc)
                        })
                        pagedDoc.<span class="keyword">set</span>(firstPageDoc: document)
                        pagesToRender.add(pagedDoc)
...
</code></pre>

<p>So for each document in the collection we retrieve the meta object and test to see if the <code>isPaged</code> property is true. If it is we retrieve the <code>pageCount</code>, <code>pageSize</code> and optionally the <code>pagedCollection</code> properties. We use this information to figure out the number of pages we&#39;re going to render, and the start and end indexes of the documents in each page. If we&#39;ve got more than one page then for each page we copy the current document, add a page object to the document and then add it to our collection of pages to render.</p>

<p>Almost there, now we just need to make these documents complete and contextual so they can be rendered:</p>

<pre class="highlighted"><code class="matlab">...
            tasks = new <span class="transposed_variable">balUtil.</span>Group(next)

            <span class="transposed_variable">pagesToRender.</span>forEach (document) -&gt;

                <span class="transposed_variable">tasks.</span>push (complete) -&gt;
                    <span class="transposed_variable">document.</span>normalize(<span class="cell">{}</span>, complete)

                <span class="transposed_variable">tasks.</span>push (complete) -&gt;
                    <span class="transposed_variable">document.</span>contextualize(<span class="cell">{}</span>, complete)

                <span class="transposed_variable">tasks.</span>push (complete) -&gt;
                    page = <span class="transposed_variable">document.</span>get(<span class="string">'page'</span>)

                    basename = <span class="transposed_variable">document.</span>get(<span class="string">'basename'</span>)
                    outFilename = <span class="transposed_variable">document.</span>get(<span class="string">'outFilename'</span>)

                    outFilename = <span class="transposed_variable">outFilename.</span>replace(basename,basename+<span class="string">'.'</span> + <span class="transposed_variable">page.</span>number)
                    basename = basename + <span class="string">'.'</span> + <span class="transposed_variable">page.</span>number

                    <span class="transposed_variable">document.</span>set(<span class="string">'basename'</span>,basename)
                    <span class="transposed_variable">document.</span>set(<span class="string">'outFilename'</span>, outFilename)

                    complete()

            <span class="transposed_variable">tasks.</span>push (complete) -&gt;
                <span class="transposed_variable">docpad.</span>generateRender(<span class="cell">{collection: pagesToRender}</span>,complete)

            <span class="keyword">return</span> <span class="transposed_variable">tasks.</span>async()
</code></pre>

<p>Here we&#39;ve used the <a href="https://github.com/balupton/bal-util"><code>bal-util</code></a> module. This module has a few helpful little methods that make doing sequences of tasks a lot cleaner. Here we&#39;ve created a sequence of tasks that will be executed asyncronously and after all tasks are completed the <code>next</code> method callback will be executed. The list of tasks is created by looping over the <code>pagesToRender</code> and for each document first normalizing it then contextualizing it then modifying its output and base filenames. Finally the last task added to the queue is to render the pagesToRender collection.</p>

<p>Normalization is basically the task which goes through the document and ensures all the values are updated appropriately, for instance if you change one value it might update another value as a knock-on effect. Contextualize is similar in that it sets the document up in the context of the rest of the site, for instance it generates the url property. So its important that we call both these methods on any new documents before we render them otherwise things just don&#39;t work quite right. This is also why we do the modification of the <code>basename</code> and <code>outFilename</code> properties after calling these methods as otherwise they would be reset back to the original document values.</p>

<p>By calling <code>tasks.async()</code> we execute the queue of tasks and then pass execution onto <code>next</code> allowing docpad to continue. With this the plugin is working! In the full version of the plugin I&#39;ve gone ahead and added some helper functions to the <code>DocumentModel</code> that make it a bit cleaner to render pagination and operate over pages, if you want to take a look checkout the <a href="https://github.com/benjamind/docpad-plugin-paged">full source here</a>.</p>

<h3>Summary</h3>

<p>So we&#39;ve built a plugin that operates within our site to render out paged documents based off an original source document. I decided to share this plugin with everyone so I&#39;ve packaged it up as a <a href="https://npmjs.org/package/docpad-plugin-paged">package on NPM</a> if you want to use it in one of your own sites. In my next post I&#39;ll explain how I did that, and how to get Unit Testing working on DocPad plugins.</p>

        </div>
    </article>
    <hr/>

    
    <article id="post" class="post">
        <h1><a href='/posts/amazon.html'>What do we learn from Amazon's success?</a></h1>
        <div class="post-date">Sunday, December 02, 2012</div>
        <div class="post-content">
            <h1>Conversion</h1>

<p>But as conversion goes, the giant is clearly Amazon. <a href="http://www.smartinsights.com/digital-marketing-strategy/online-business-revenue-models/amazon-case-study/">Amazon generates 47
times as much revenue per unique visitor as Facebook</a>. </p>

<p>Why is this important?
Amazon expertly leverages online behavior to optimize conversions. Its
suggestive shopping engine offers an excellent example of tying visitor actions
into personalized offers. Amazon focuses on visitor intent and site optimization
to sell more.
Amazon’s obsessive focus on measuring every single visitor action led to online
product revenues of USD 42 billion in 2011, <a href="http://www.reportlinker.com/p0925320-summary/Consumer-Attitudes-and-Online-Retail-Dynamics-in-the-US.html">21 percent of online retail sales
in the country</a>. Estimates on Amazon’s conversion rates range from 9.8 to 18
percent. Whatever the actual number is, it&#39;s far higher than the industry average.
Amazon&#39;s behavioral targeting strategy is brilliant.</p>

        </div>
    </article>
    <hr/>

    
    <article id="post" class="post">
        <h1><a href='/posts/creating-the-index-page.html'>Creating the index page</a></h1>
        <div class="post-date">Monday, November 12, 2012</div>
        <div class="post-content">
            <p>Now that we&#39;ve got Docpad up and running, the last thing thats absolutely essential is to get the site showing the blog posts on the index page. You&#39;d think this would be simple, and it really is, but it stumped me for a little while before I found the appropriate documentation.</p>

<p>Now I&#39;m not certain this is the best way of doing things but it works for me and its simple enough. To display the last N blog posts on your index page do something like this:</p>

<pre class="highlighted"><code class="coffeescript">    &lt;% <span class="keyword">for</span> document,i <span class="keyword">in</span> <span class="property">@getCollection</span>(<span class="string">'posts'</span>).toJSON(): %&gt;

    &lt;% <span class="keyword">break</span> <span class="keyword">if</span> i &gt; <span class="number">2</span> %&gt;

    &lt;article id=<span class="string">"post"</span> class=<span class="string">"post"</span>&gt;
        &lt;h1&gt;&lt;a href=<span class="string">'&lt;%=document.url%&gt;'</span>&gt;&lt;%= document.title %&gt;&lt;<span class="regexp">/a&gt;&lt;/</span>h1&gt;
        &lt;div class=<span class="string">"post-date"</span>&gt;&lt;%= document.date.toLocaleDateString() %&gt;&lt;/div&gt;
        &lt;div class=<span class="string">"post-content"</span>&gt;
            &lt;%- document.contentRenderedWithoutLayouts %&gt;
        &lt;/div&gt;
    &lt;/article&gt;
    &lt;% end %&gt;
</code></pre>

<p>This simply says loop over the collection of &#39;posts&#39;, break the loop if the <code>i</code> variable is greater than 2 (remember this is a for loop so its zero indexed). Then we simply render the article, and use the <code>document.contentRenderedWithoutLayouts</code> rather than the usual @content. We do this since we&#39;re already &#39;laid out&#39; so we don&#39;t need the full layout of the document again.</p>

        </div>
    </article>
    <hr/>


<ul class="pager">
    
        <li class="previous"><a href="/blog.1.html">&larr; Older</a></li>
    
    
        <li class="next disabled"><span>Newer &rarr;</span></li>
    
</ul>

</div>
<!-- end container post -->

<!-- TODO, get this into partials -->
<!-- start of footer -->
    <footer>
        <div class="container widgets">
            <div class="one-third column  about">
                <h2>About Me</h2>
                <img src="images/josequesada.jpg" alt="" class="thumb"/>
                <div>
                    <p>I'm a modeler, with a PhD in Machine learning. I worked at top labs (U. of Colorado, Boulder; Carnegie Mellon); But my specialty is to find and optimize business value. If you think you can decide better, do better, or be better through data, contact me for a free consultation: </p>

                    <script type="text/javascript" language="javascript">
                    <!--
                    // Email obfuscator script 2.1 by Tim Williams, University of Arizona
                    // Random encryption key feature by Andrew Moulden, Site Engineering Ltd
                    // This code is freeware provided these four comment lines remain intact
                    // A wizard to generate this code is at http://www.jottings.com/obfuscator/
                    { coded = "Ga@EOmac4amWvW.7OG"
                      key = "01yc9R8u3rmDNFLvWo5AC7YgV4nfG6zMjwkOxHJUileBZQTqbKE2IpsPShtdaX"
                      shift=coded.length
                      link=""
                      for (i=0; i<coded.length; i++) {
                        if (key.indexOf(coded.charAt(i))==-1) {
                          ltr = coded.charAt(i)
                          link += (ltr)
                        }
                        else {
                          ltr = (key.indexOf(coded.charAt(i))-shift+key.length) % key.length
                          link += (key.charAt(ltr))
                        }
                      }
                    document.write("<a href='mailto:"+link+"'>me@josequesada.com</a>")
                    }
                    //-->
                    </script><noscript>Sorry, you need Javascript on to email me.</noscript>
                    <br>



                    <ul>
                        <!-- <li><a href="#" target="_blank"><img src="images/facebook.png" alt="" /></a></li> -->
                        <li><a href="https://twitter.com/quesada" target="_blank"><img src="images/twitter.png" alt="" /></a></li>
                        <li><a href="de.linkedin.com/in/jfquesada/" target="_blank"><img src="images/linkedin.jpg" alt="" /></a></li>

                        <li><a href="atom.xml" target="_blank"><img src="images/rss.png" alt="" /></a></li>
                    </ul>
                </div>
            </div>

            <div class="one-third column  blog">
               <h2>Resources</h2>
                <nav>
                    <ul>
                        
                            <li class="active">
                                <a href="/blog.html" property="dc:title">Blog</a>
                            </li>
                        
                    </ul>
                </nav>
            </div>

  <div class="one-third column  blog">
        <h2>Recent posts</h2>
            <nav>
                <ul>
                    
                    
                        
                        <li class="">
                            <a href="/posts/technical-reasons-not-to-pic-google-website-optimizer.html" property="dc:title">Technical reasons not to use google website optimizer (and Usability reasons too)</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/unit-testing-docpad-plugins.html" property="dc:title">Unit Testing DocPad plugins</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/creating-a-docpad-plugin.html" property="dc:title">Creating a DocPad plugin</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/amazon.html" property="dc:title">What do we learn from Amazon's success?</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/creating-the-index-page.html" property="dc:title">Creating the index page</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/blogging-with-docpad.html" property="dc:title">Blogging with DocPad</a>
                        </li>
                    
                        
                        <li class="">
                            <a href="/posts/going-static.html" property="dc:title">Going Static</a>
                        </li>
                    
                </ul>
            </nav>
                <a class="dark-more">view more</a>
            </div>
    </footer>

    <footer class="sub-footer">
            <div class="container">
                <div class="eight columns left">
                    <p>Copyright 2012 <a href="#">Made with love from Berlin</a> </p>
                </div>

                <div class="eight columns right">
                    <div class="mixpanel">
                        <a href="https://mixpanel.com/f/partner"><img src="http://cdn.mxpnl.com/site_media/images/partner/badge_blue.png" alt="Mobile Analytics" /></a>
                    </div>
                    <!-- <h1 class="logo"><a href="#" title="Jose Quesada">Jose Quesada</a></h1> -->
                </div>
            </div>
    </footer>
    <script  src="/socket.io/socket.io.js"></script><script >var socket = io.connect('/docpad-live-reload');
socket.on('regenerated',function(){
	document.location.reload();
});</script>
</body>
</html>