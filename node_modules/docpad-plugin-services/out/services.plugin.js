// Generated by CoffeeScript 1.4.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

module.exports = function(BasePlugin) {
  var ServicesPlugin;
  return ServicesPlugin = (function(_super) {

    __extends(ServicesPlugin, _super);

    function ServicesPlugin() {
      return ServicesPlugin.__super__.constructor.apply(this, arguments);
    }

    ServicesPlugin.prototype.name = 'services';

    ServicesPlugin.prototype.populateCollections = function(opts) {
      var config, docpad, gaugesSiteId, googleAccountId, mixpanelId, reinvigorateId, scripts, scriptsBlock, templateData, zopimId, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9;
      docpad = this.docpad;
      config = this.config;
      templateData = docpad.getTemplateData();
      scriptsBlock = docpad.getBlock('scripts');
      scripts = [];
      gaugesSiteId = (_ref = templateData.site) != null ? (_ref1 = _ref.services) != null ? _ref1.gauges : void 0 : void 0;
      if (gaugesSiteId) {
        scripts.push("var _gauges = _gauges || [];\n(function() {\n	var t   = document.createElement('script');\n	t.type  = 'text/javascript';\n	t.async = true;\n	t.id    = 'gauges-tracker';\n	t.setAttribute('data-site-id', '" + gaugesSiteId + "');\n	t.src = '//secure.gaug.es/track.js';\n	var s = document.getElementsByTagName('script')[0];\n	s.parentNode.insertBefore(t, s);\n})();");
      }
      googleAccountId = (_ref2 = templateData.site) != null ? (_ref3 = _ref2.services) != null ? _ref3.googleAnalytics : void 0 : void 0;
      if (googleAccountId) {
        scripts.push("var _gaq = _gaq || [];\n_gaq.push(['_setAccount', '" + googleAccountId + "']);\n_gaq.push(['_trackPageview']);\n(function() {\n	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n})();");
      }
      mixpanelId = (_ref4 = templateData.site) != null ? (_ref5 = _ref4.services) != null ? _ref5.mixpanel : void 0 : void 0;
      if (mixpanelId) {
        scripts.push("(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement(\"script\");b.type=\"text/javascript\";b.async=!0;b.src=(\"https:\"===c.location.protocol?\"https:\":\"http:\")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';d=c.getElementsByTagName(\"script\")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(\".\");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;\"undefined\"!==typeof f?g=a[f]=[]:f=\"mixpanel\";g.people=g.people||[];h=['disable','track','track_pageview','track_links','track_forms','register','register_once','unregister','identify','alias','name_tag','set_config','people.set','people.increment'];for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.2;})(document,window.mixpanel||[]);mixpanel.init(\"" + mixpanelId + "\");");
      }
      reinvigorateId = (_ref6 = templateData.site) != null ? (_ref7 = _ref6.services) != null ? _ref7.reinvigorate : void 0 : void 0;
      if (reinvigorateId) {
        scripts.push("// Add the depedency if it doesn't already exist\nif ( typeof io === 'undefined' ) {\n	var t = document.createElement('script');\n	t.type = 'text/javascript';\n	t.async = true;\n	t.src = '//include.reinvigorate.net/re_.js';\n	t.onload = function(){\n		reinvigorate.track(\"" + reinvigorateId + "\");\n	};\n	var s = document.getElementsByTagName('script')[0];\n	s.parentNode.insertBefore(t,s);\n}");
      }
      zopimId = (_ref8 = templateData.site) != null ? (_ref9 = _ref8.services) != null ? _ref9.zopim : void 0 : void 0;
      if (zopimId) {
        scripts.push("window.$zopim||(function(d,s){var z=$zopim=function(c){z._.push(c)},$=z.s=d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set._.push(o)};z._=[];z.set._=[];$.async=!0;$.setAttribute('charset','utf-8');$.src='//cdn.zopim.com/?" + zopimId + "';z.t=+new Date;$.type='text/javascript';e.parentNode.insertBefore($,e)})(document,'script');");
      }
      scriptsBlock.add(scripts, {
        defer: false
      });
      return this;
    };

    return ServicesPlugin;

  })(BasePlugin);
};
